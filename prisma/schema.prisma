generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

// -----------------------------------------------------------------------------
// 1. Auth & Users (NextAuth.js v5 Adapter)
// -----------------------------------------------------------------------------

model User {
    id            String    @id @default(uuid())
    name          String?
    email         String?   @unique
    emailVerified DateTime?
    image         String?
    password      String?

    role       UserRole @default(GUEST)
    employeeId String?  @unique

    // Extended Profile
    phone       String?
    dateOfBirth DateTime?
    nationality String?
    address     String?   @db.Text
    idScans     String[]

    accounts  Account[]
    sessions  Session[]
    bookings  Booking[]
    reviews   Review[]
    analytics AnalyticsEvent[]

    // Business Unit / Property Management
    managedProperties Property[] @relation("PropertyManagers")
    defaultPropertyId String?

    // Custom RBAC & Organization
    roleId       String?
    userRole     Role?       @relation(fields: [roleId], references: [id])
    departmentId String?
    department   Department? @relation(fields: [departmentId], references: [id])
    status       String      @default("ACTIVE") // ACTIVE, INACTIVE, SUSPENDED

    // Membership & Preferences
    membership  Membership?
    preferences UserPreferences?

    isTwoFactorEnabled    Boolean                @default(false)
    twoFactorConfirmation TwoFactorConfirmation?

    deletedAt DateTime?

    createdAt             DateTime              @default(now())
    updatedAt             DateTime              @updatedAt
    properties            Property[]
    userWarehouseAccesses UserWarehouseAccess[]

    // POS Relations
    serverOrders      POSOrder[]     @relation("ServerOrders")
    processedPayments OrderPayment[] @relation("PaymentProcessor")
    cashierShifts     Shift[]        @relation("CashierShifts")
    shiftHandovers    Shift[]        @relation("ShiftHandover")

    // Purchase Order Relations
    createdPOs    PurchaseOrder[] @relation("POCreatedBy")
    approvedPOs   PurchaseOrder[] @relation("POApprovedBy")
    poReceipts    POReceipt[]     @relation("POReceiver")
    auditLogs     AuditLog[]
    notifications Notification[]
    shiftReadings ShiftReading[]  @relation("ReadingGenerator")

    // Discount/Void approvals
    approvedDiscounts OrderDiscount[] @relation("DiscountApprover")
    approvedVoids     OrderVoid[]     @relation("VoidApprover")
    createdVoids      OrderVoid[]     @relation("VoidCreator")

    @@index([email])
    @@index([role])
}

model Role {
    id          String  @id @default(uuid())
    name        String  @unique // e.g. "Admin", "Manager", "Guest"
    description String?
    isSystem    Boolean @default(false) // If true, cannot be deleted (e.g. Super Admin)

    // Permissions stored as String list of keys e.g. ["users:view", "bookings:edit"]
    permissions String[]

    users     User[]
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Department {
    id        String   @id @default(uuid())
    name      String   @unique
    users     User[]
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

enum UserRole {
    GUEST
    ADMIN
    STAFF
}

model Account {
    id                String  @id @default(uuid())
    userId            String
    type              String
    provider          String
    providerAccountId String
    refresh_token     String? @db.Text
    access_token      String? @db.Text
    expires_at        Int?
    token_type        String?
    scope             String?
    id_token          String? @db.Text
    session_state     String?

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([provider, providerAccountId])
}

model Session {
    id           String   @id @default(uuid())
    sessionToken String   @unique
    userId       String
    expires      DateTime
    user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
    identifier String
    token      String   @unique
    expires    DateTime

    @@unique([identifier, token])
}

model PasswordResetToken {
    id      String   @id @default(uuid())
    email   String
    token   String   @unique
    expires DateTime

    @@unique([email, token])
}

model TwoFactorToken {
    id      String   @id @default(uuid())
    email   String
    token   String   @unique
    expires DateTime

    @@unique([email, token])
}

model TwoFactorConfirmation {
    id String @id @default(uuid())

    userId String
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([userId])
}

// Membership & Loyalty
model Membership {
    id     String @id @default(uuid())
    userId String @unique
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    tier   MembershipTier @default(STANDARD)
    points Int            @default(0)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

enum MembershipTier {
    STANDARD // New users, no perks
    SILVER // 1,000+ points
    GOLD // 5,000+ points
    PLATINUM // 10,000+ points
}

// User Stay Preferences
model UserPreferences {
    id     String @id @default(uuid())
    userId String @unique
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    roomTemperature     String? // cool, standard, warm
    pillowType          String? // feather, foam, hypo, firm
    dietaryRestrictions String? @db.Text
    turndownService     Boolean @default(false)
    newspaper           Boolean @default(false)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

// Newsletter Subscriptions
model NewsletterSubscriber {
    id       String  @id @default(uuid())
    email    String  @unique
    isActive Boolean @default(true)

    createdAt DateTime @default(now())
}

// -----------------------------------------------------------------------------
// 2. Integration & Catalog (Properties, Rooms, Content)
// -----------------------------------------------------------------------------

model Property {
    id              String  @id @default(uuid())
    slug            String  @unique
    name            String
    location        String
    description     String  @db.Text
    longDescription String  @db.Text
    image           String // Main hero image
    facebookPageId  String?

    // Configuration
    taxRate           Decimal @default(0.12) @db.Decimal(5, 4)
    serviceChargeRate Decimal @default(0.10) @db.Decimal(5, 4)

    images    PropertyImage[]
    policies  PropertyPolicy[]
    rooms     Room[]
    floorPlan FloorPlan?
    amenities PropertyAmenity[] // Many-to-many via explicit table or implicit
    reviews   Review[]

    managers User[] @relation("PropertyManagers")

    createdAt  DateTime    @default(now())
    updatedAt  DateTime    @updatedAt
    bookings   Booking[]
    user       User?       @relation(fields: [userId], references: [id])
    userId     String?
    warehouses Warehouse[]
    stockItems StockItem[]
    menuItems  MenuItem[]

    // POS Relations
    salesOutlets   SalesOutlet[]
    purchaseOrders PurchaseOrder[]
    events         Event[]
    discountTypes  DiscountType[]
    menuCategories MenuCategory[]
}

model PropertyPolicy {
    id          String   @id @default(uuid())
    propertyId  String
    property    Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
    title       String
    description String   @db.Text

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([propertyId])
}

model PropertyImage {
    id         String   @id @default(uuid())
    url        String
    caption    String?
    propertyId String
    property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model Room {
    id          String  @id @default(uuid())
    propertyId  String
    name        String
    description String  @db.Text
    capacity    Int
    price       Decimal @db.Decimal(10, 2)
    sizeSqM     Float?
    image       String

    property  Property      @relation(fields: [propertyId], references: [id], onDelete: Cascade)
    amenities String[] // Array of simple strings for room amenities
    floorPlan FloorPlan?
    bookings  BookingItem[]

    units         RoomUnit[] // Individual room units (101, 102, etc.)
    seasonalRates SeasonalRate[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([propertyId])
}

model SeasonalRate {
    id         String @id @default(uuid())
    roomTypeId String
    roomType   Room   @relation(fields: [roomTypeId], references: [id], onDelete: Cascade)

    startDate DateTime
    endDate   DateTime

    adjustmentType String // PERCENTAGE, ABSOLUTE
    value          Decimal @db.Decimal(10, 2)
    priority       Int     @default(0) // Higher preference wins

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([roomTypeId])
    @@index([startDate, endDate])
}

// Individual room units for inventory management
model RoomUnit {
    id         String         @id @default(uuid())
    roomTypeId String
    roomType   Room           @relation(fields: [roomTypeId], references: [id], onDelete: Cascade)
    number     String // Room number: "101", "102"
    floor      Int? // Optional floor number
    status     RoomUnitStatus @default(CLEAN)
    isActive   Boolean        @default(true)
    notes      String?        @db.Text

    deletedAt DateTime?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    bookingItems BookingItem[]

    @@index([roomTypeId])
    @@index([status])
}

enum RoomUnitStatus {
    CLEAN
    DIRTY
    OCCUPIED
    MAINTENANCE
    OUT_OF_ORDER
}

model PropertyAmenity {
    id         String   @id @default(uuid())
    name       String
    icon       String?
    propertyId String
    property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

// Interactive Floor Plans
model FloorPlan {
    id       String @id @default(uuid())
    imageUrl String

    // Relations (A floor plan can belong to a Property OR a Room)
    propertyId String?   @unique
    property   Property? @relation(fields: [propertyId], references: [id], onDelete: Cascade)

    roomId String? @unique
    room   Room?   @relation(fields: [roomId], references: [id], onDelete: Cascade)

    hotspots Hotspot[]
}

model Hotspot {
    id          String  @id @default(uuid())
    floorPlanId String
    label       String
    description String?
    type        String // lobby, pool, etc.
    x           Float // Percentage coordinates (0-100)
    y           Float

    floorPlan FloorPlan @relation(fields: [floorPlanId], references: [id], onDelete: Cascade)
}

// Content: Local Experiences
model Experience {
    id          String @id @default(uuid())
    title       String
    description String @db.Text
    category    String // Nature, Culture, Food, etc.
    image       String
    distance    String

    createdAt DateTime @default(now())
}

// -----------------------------------------------------------------------------
// 3. Commerce (Bookings, Coupons)
// -----------------------------------------------------------------------------

model Booking {
    id       String @id @default(uuid())
    shortRef String @unique // Short reference code (e.g. "ABC-123")

    userId String? // Optional: Guest might not be logged in (guest checkout)
    user   User?   @relation(fields: [userId], references: [id])

    // Guest Details (Snapshot for this specific booking)
    guestFirstName  String
    guestLastName   String
    guestEmail      String
    guestPhone      String
    specialRequests String? @db.Text

    // Financials
    totalAmount   Decimal       @db.Decimal(10, 2)
    taxAmount     Decimal       @db.Decimal(10, 2)
    serviceCharge Decimal       @db.Decimal(10, 2)
    amountPaid    Decimal       @default(0) @db.Decimal(10, 2)
    amountDue     Decimal       @db.Decimal(10, 2)
    currency      String        @default("PHP")
    status        BookingStatus @default(PENDING)
    paymentStatus PaymentStatus @default(UNPAID)

    propertyId String?
    property   Property? @relation(fields: [propertyId], references: [id])

    items       BookingItem[]
    payments    Payment[]
    refunds     Refund[]
    adjustments BookingAdjustment[]

    // POS Relations (Room Charges)
    posOrders POSOrder[]

    // Guest Lookup Tokens
    lookupTokens BookingLookupToken[]

    // Short-lived Verification Tokens (for guest checkout)
    verificationTokens BookingVerificationToken[]

    // Audit & Soft Delete
    deletedAt   DateTime?
    createdById String?
    updatedById String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    event     Event?   @relation(fields: [eventId], references: [id])
    eventId   String?

    @@index([status])
    @@index([paymentStatus])
    @@index([userId])
    @@index([shortRef])
}

// Guest Booking Lookup Token
model BookingLookupToken {
    id        String   @id @default(uuid())
    bookingId String
    booking   Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
    tokenHash String   @unique // SHA-256 hash of the token
    expiresAt DateTime
    createdAt DateTime @default(now())

    @@index([bookingId])
    @@index([expiresAt])
}

// Short-lived Booking Verification Token (for guest checkout)
model BookingVerificationToken {
    id        String   @id @default(uuid())
    bookingId String
    booking   Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
    tokenHash String   @unique // SHA-256 hash of the token
    expiresAt DateTime // 15 minutes from creation
    createdAt DateTime @default(now())

    @@index([bookingId])
    @@index([expiresAt])
}

enum BookingStatus {
    PENDING
    CONFIRMED
    CHECKED_IN
    CANCELLED
    COMPLETED
}

enum PaymentStatus {
    UNPAID
    PAID
    PARTIALLY_PAID
    REFUNDED
    FAILED
    EXPIRED
}

model Payment {
    id        String  @id @default(uuid())
    bookingId String
    amount    Decimal @db.Decimal(10, 2)
    currency  String  @default("PHP")
    provider  String  @default("PAYMONGO")
    status    String // PAID, PENDING, FAILED

    // Consolidated Payment Fields
    transactionId   String? // Provider's Transaction ID
    paymentMethodId String?
    sourceId        String?
    externalId      String? @unique
    reference       String? // User provided reference/remarks

    metadata Json?

    // Timestamps & Audit
    paidAt        DateTime?
    failedAt      DateTime?
    failureReason String?

    deletedAt   DateTime?
    createdById String?
    updatedById String?

    booking Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
    refunds Refund[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([status])
    @@index([bookingId])
    @@index([externalId])
}

model Refund {
    id        String  @id @default(uuid())
    bookingId String
    paymentId String?

    amount Decimal @db.Decimal(10, 2)
    reason String?
    status String // PENDING, COMPLETED, FAILED

    processedAt DateTime?

    booking Booking  @relation(fields: [bookingId], references: [id])
    payment Payment? @relation(fields: [paymentId], references: [id])

    createdAt DateTime @default(now())

    @@index([bookingId])
}

model BookingAdjustment {
    id        String  @id @default(uuid())
    bookingId String
    booking   Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

    type        String // CHARGE, DISCOUNT
    amount      Decimal   @db.Decimal(10, 2)
    description String
    isVoided    Boolean   @default(false)
    voidedAt    DateTime?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    createdById String?
    updatedById String?

    @@index([bookingId])
}

model BookingItem {
    id        String @id @default(uuid())
    bookingId String
    roomId    String

    checkIn       DateTime
    checkOut      DateTime
    guests        Int
    pricePerNight Decimal  @db.Decimal(10, 2) // Price snapshot at time of booking

    booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
    room    Room    @relation(fields: [roomId], references: [id])

    // Inventory Assignment
    roomUnitId String?
    roomUnit   RoomUnit? @relation(fields: [roomUnitId], references: [id])

    @@index([bookingId])
    @@index([roomId])
    @@index([checkIn])
    @@index([checkOut])
}

model Coupon {
    id          String     @id @default(uuid())
    code        String     @unique
    type        CouponType
    value       Decimal    @db.Decimal(10, 2)
    description String?
    isActive    Boolean    @default(true)
    expiresAt   DateTime?
}

enum CouponType {
    PERCENTAGE
    FIXED_AMOUNT
}

// -----------------------------------------------------------------------------
// 4. Social & Analytics
// -----------------------------------------------------------------------------

model Review {
    id      String  @id @default(uuid())
    rating  Int // 1-5
    comment String? @db.Text

    userId String
    user   User   @relation(fields: [userId], references: [id])

    propertyId String
    property   Property @relation(fields: [propertyId], references: [id])

    createdAt DateTime @default(now())
}

model AnalyticsEvent {
    id        String  @id @default(uuid())
    eventType String // VIEW_PAGE, ADD_TO_CART, BOOKING_INITIATED
    url       String?
    metadata  Json? // Flexible JSON for event details

    userId String?
    user   User?   @relation(fields: [userId], references: [id])

    createdAt DateTime @default(now())
}

// -----------------------------------------------------------------------------
// 5. PayMongo Webhook Events (Idempotency)
// -----------------------------------------------------------------------------

model PayMongoWebhookEvent {
    id              String    @id @default(uuid())
    eventId         String    @unique // PayMongo event ID for deduplication
    eventType       String // checkout_session.payment.paid, etc.
    paymentIntentId String?
    processed       Boolean   @default(false)
    processedAt     DateTime?
    processingError String?   @db.Text
    rawPayload      Json?

    createdAt DateTime @default(now())
}

// -----------------------------------------------------------------------------
// 6. Inventory Management System
// -----------------------------------------------------------------------------

// Warehouse Management
model Warehouse {
    id         String        @id @default(uuid())
    propertyId String
    property   Property      @relation(fields: [propertyId], references: [id])
    name       String
    type       WarehouseType
    isActive   Boolean       @default(true)

    stockLevels      StockLevel[]
    stockBatches     StockBatch[]
    movementsFrom    StockMovement[] @relation("SourceWarehouse")
    movementsTo      StockMovement[] @relation("DestinationWarehouse")
    requisitionsFrom Requisition[]   @relation("RequestingWarehouse")
    requisitionsTo   Requisition[]   @relation("SourceWarehouse")
    linens           LinenItem[]
    wasteRecords     WasteRecord[]
    parLevels        StockParLevel[]

    createdAt             DateTime              @default(now())
    updatedAt             DateTime              @updatedAt
    cycleCounts           CycleCount[]
    userWarehouseAccesses UserWarehouseAccess[]

    // POS Relations
    salesOutlets   SalesOutlet[]
    purchaseOrders PurchaseOrder[]

    @@unique([propertyId, name])
    @@index([propertyId])
}

enum WarehouseType {
    MAIN_STOCKROOM
    KITCHEN
    HOUSEKEEPING
    BAR
    MINIBAR
}

// Stock Item Catalog
model StockItem {
    id            String        @id @default(uuid())
    itemCode      String        @unique // Auto-generated: ITM-0001, ITM-0002, etc.
    propertyId    String
    property      Property      @relation(fields: [propertyId], references: [id])
    name          String
    sku           String? // Optional manual SKU
    categoryId    String
    category      StockCategory @relation(fields: [categoryId], references: [id])
    primaryUnitId String
    primaryUnit   UnitOfMeasure @relation(fields: [primaryUnitId], references: [id])
    isConsignment Boolean       @default(false)
    supplierId    String?
    supplier      Supplier?     @relation(fields: [supplierId], references: [id])
    isActive      Boolean       @default(true)

    stockLevels       StockLevel[]
    stockBatches      StockBatch[]
    movements         StockMovement[]
    recipeIngredients RecipeIngredient[]
    parLevels         StockParLevel[]
    linens            LinenItem[]
    consignmentItems  ConsignmentReceiptItem[]
    wasteRecords      WasteRecord[]

    createdAt          DateTime            @default(now())
    updatedAt          DateTime            @updatedAt
    requisitionItems   RequisitionItem[]
    cycleCountItems    CycleCountItem[]
    purchaseOrderItems PurchaseOrderItem[]
    poreceiptItems     POReceiptItem[]

    @@unique([propertyId, sku])
    @@index([propertyId])
    @@index([categoryId])
    @@index([itemCode])
}

// Stock Category (dynamic, user-manageable)
model StockCategory {
    id          String  @id @default(uuid())
    name        String  @unique
    description String?
    color       String? // For UI display (e.g., "orange", "#FF5733")
    isSystem    Boolean @default(false) // System categories cannot be deleted
    isActive    Boolean @default(true)

    stockItems StockItem[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model UnitOfMeasure {
    id               String          @id @default(uuid())
    name             String          @unique
    abbreviation     String          @unique
    baseUnitId       String?
    baseUnit         UnitOfMeasure?  @relation("UnitConversion", fields: [baseUnitId], references: [id])
    derivedUnits     UnitOfMeasure[] @relation("UnitConversion")
    conversionFactor Decimal         @default(1) @db.Decimal(10, 4)

    stockItems        StockItem[]
    recipeIngredients RecipeIngredient[]
    recipeYields      Recipe[]
}

model Supplier {
    id          String  @id @default(uuid())
    name        String
    contactName String?
    email       String?
    phone       String?
    address     String? @db.Text
    isActive    Boolean @default(true)

    stockItems             StockItem[]
    consignmentReceipts    ConsignmentReceipt[]
    consignmentSettlements ConsignmentSettlement[]

    createdAt      DateTime        @default(now())
    updatedAt      DateTime        @updatedAt
    purchaseOrders PurchaseOrder[]
}

// Stock Levels & Movements
model StockLevel {
    id          String    @id @default(uuid())
    stockItemId String
    stockItem   StockItem @relation(fields: [stockItemId], references: [id])
    warehouseId String
    warehouse   Warehouse @relation(fields: [warehouseId], references: [id])
    quantity    Decimal   @db.Decimal(10, 3)
    averageCost Decimal   @db.Decimal(10, 4)

    updatedAt DateTime @updatedAt

    @@unique([stockItemId, warehouseId])
    @@index([warehouseId])
}

model StockParLevel {
    id          String    @id @default(uuid())
    stockItemId String
    stockItem   StockItem @relation(fields: [stockItemId], references: [id])
    warehouseId String
    warehouse   Warehouse @relation(fields: [warehouseId], references: [id])
    parLevel    Decimal   @db.Decimal(10, 3)

    @@unique([stockItemId, warehouseId])
}

model StockMovement {
    id                     String       @id @default(uuid())
    stockItemId            String
    stockItem              StockItem    @relation(fields: [stockItemId], references: [id])
    batchId                String?
    batch                  StockBatch?  @relation(fields: [batchId], references: [id])
    sourceWarehouseId      String?
    sourceWarehouse        Warehouse?   @relation("SourceWarehouse", fields: [sourceWarehouseId], references: [id])
    destinationWarehouseId String?
    destinationWarehouse   Warehouse?   @relation("DestinationWarehouse", fields: [destinationWarehouseId], references: [id])
    type                   MovementType
    quantity               Decimal      @db.Decimal(10, 3)
    unitCost               Decimal?     @db.Decimal(10, 4)
    totalCost              Decimal?     @db.Decimal(10, 2)
    referenceType          String?
    referenceId            String?
    reason                 String?
    createdById            String

    createdAt DateTime @default(now())

    @@index([stockItemId])
    @@index([batchId])
    @@index([sourceWarehouseId])
    @@index([destinationWarehouseId])
    @@index([createdAt])
}

enum MovementType {
    RECEIPT
    TRANSFER_IN
    TRANSFER_OUT
    CONSUMPTION
    ADJUSTMENT
    RETURN
    WASTE
}

// Batch/Lot Tracking
model StockBatch {
    id             String    @id @default(uuid())
    stockItemId    String
    stockItem      StockItem @relation(fields: [stockItemId], references: [id])
    warehouseId    String
    warehouse      Warehouse @relation(fields: [warehouseId], references: [id])
    batchNumber    String
    quantity       Decimal   @db.Decimal(10, 3)
    unitCost       Decimal   @db.Decimal(10, 4)
    expirationDate DateTime?
    receivedAt     DateTime  @default(now())
    isExpired      Boolean   @default(false)

    movements    StockMovement[]
    wasteRecords WasteRecord[]

    createdAt       DateTime         @default(now())
    updatedAt       DateTime         @updatedAt
    cycleCountItems CycleCountItem[]

    @@unique([stockItemId, warehouseId, batchNumber])
    @@index([warehouseId])
    @@index([expirationDate])
    @@index([isExpired])
}

// Waste Tracking
model WasteRecord {
    id           String      @id @default(uuid())
    stockItemId  String
    stockItem    StockItem   @relation(fields: [stockItemId], references: [id])
    warehouseId  String
    warehouse    Warehouse   @relation(fields: [warehouseId], references: [id])
    batchId      String?
    batch        StockBatch? @relation(fields: [batchId], references: [id])
    wasteType    WasteType
    quantity     Decimal     @db.Decimal(10, 3)
    unitCost     Decimal     @db.Decimal(10, 4)
    totalCost    Decimal     @db.Decimal(10, 2)
    reason       String?     @db.Text
    recordedById String

    createdAt DateTime @default(now())

    @@index([stockItemId])
    @@index([warehouseId])
    @@index([wasteType])
    @@index([createdAt])
}

enum WasteType {
    SPOILAGE
    EXPIRED
    DAMAGED
    OVERPRODUCTION
    PREPARATION_WASTE
}

// -----------------------------------------------------------------------------
// 7. Requisitions
// -----------------------------------------------------------------------------

model Requisition {
    id                    String            @id @default(uuid())
    requestingWarehouseId String
    requestingWarehouse   Warehouse         @relation("RequestingWarehouse", fields: [requestingWarehouseId], references: [id])
    sourceWarehouseId     String
    sourceWarehouse       Warehouse         @relation("SourceWarehouse", fields: [sourceWarehouseId], references: [id])
    status                RequisitionStatus @default(PENDING)
    requestedById         String
    approvedById          String?
    rejectionReason       String?
    notes                 String?           @db.Text

    items RequisitionItem[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([requestingWarehouseId])
    @@index([sourceWarehouseId])
    @@index([status])
}

enum RequisitionStatus {
    PENDING
    APPROVED
    PARTIALLY_FULFILLED
    FULFILLED
    REJECTED
}

model RequisitionItem {
    id                String      @id @default(uuid())
    requisitionId     String
    requisition       Requisition @relation(fields: [requisitionId], references: [id], onDelete: Cascade)
    stockItemId       String
    stockItem         StockItem   @relation(fields: [stockItemId], references: [id])
    requestedQuantity Decimal     @db.Decimal(10, 3)
    fulfilledQuantity Decimal     @default(0) @db.Decimal(10, 3)

    @@index([requisitionId])
    @@index([stockItemId])
}

// -----------------------------------------------------------------------------
// 8. Recipe & Menu Management
// -----------------------------------------------------------------------------

model Recipe {
    id                       String        @id @default(uuid())
    name                     String
    description              String?       @db.Text
    yield                    Decimal       @db.Decimal(10, 2)
    yieldUnitId              String
    yieldUnit                UnitOfMeasure @relation(fields: [yieldUnitId], references: [id])
    instructions             String?       @db.Text
    prepTimeMinutes          Int?
    cookTimeMinutes          Int?
    isActive                 Boolean       @default(true)
    minimumServingsThreshold Int           @default(5) // Disable menu item if available servings fall below this

    ingredients   RecipeIngredient[]
    parentRecipes RecipeSubRecipe[]  @relation("ChildRecipe")
    childRecipes  RecipeSubRecipe[]  @relation("ParentRecipe")
    menuItems     MenuItem[]
    cogsRecords   COGSRecord[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model RecipeIngredient {
    id          String        @id @default(uuid())
    recipeId    String
    recipe      Recipe        @relation(fields: [recipeId], references: [id], onDelete: Cascade)
    stockItemId String
    stockItem   StockItem     @relation(fields: [stockItemId], references: [id])
    quantity    Decimal       @db.Decimal(10, 3)
    unitId      String
    unit        UnitOfMeasure @relation(fields: [unitId], references: [id])
    notes       String?

    @@index([recipeId])
}

model RecipeSubRecipe {
    id             String  @id @default(uuid())
    parentRecipeId String
    parentRecipe   Recipe  @relation("ParentRecipe", fields: [parentRecipeId], references: [id], onDelete: Cascade)
    childRecipeId  String
    childRecipe    Recipe  @relation("ChildRecipe", fields: [childRecipeId], references: [id])
    quantity       Decimal @db.Decimal(10, 2)

    @@unique([parentRecipeId, childRecipeId])
}

// Dynamic Menu Categories (user-manageable)
model MenuCategory {
    id          String    @id @default(uuid())
    propertyId  String?
    property    Property? @relation(fields: [propertyId], references: [id])
    name        String
    description String?
    color       String? // For UI display (e.g., "#FF5733", "orange")
    icon        String? // Optional icon name (e.g., "UtensilsCrossed", "Coffee")
    sortOrder   Int       @default(0)
    isActive    Boolean   @default(true)

    menuItems MenuItem[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([propertyId, name])
    @@index([propertyId])
}

model MenuItem {
    id                String       @id @default(uuid())
    propertyId        String
    property          Property     @relation(fields: [propertyId], references: [id])
    name              String
    description       String?      @db.Text
    categoryId        String
    category          MenuCategory @relation(fields: [categoryId], references: [id])
    sellingPrice      Decimal      @db.Decimal(10, 2)
    recipeId          String?
    recipe            Recipe?      @relation(fields: [recipeId], references: [id])
    isAvailable       Boolean      @default(true)
    unavailableReason String?
    imageUrl          String? // MinIO URL for menu item image
    availableServings Int? // Cached count of available servings based on stock

    cogsRecords COGSRecord[]

    // POS Relations
    orderItems POSOrderItem[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([propertyId])
    @@index([categoryId])
}

model COGSRecord {
    id           String   @id @default(uuid())
    menuItemId   String
    menuItem     MenuItem @relation(fields: [menuItemId], references: [id])
    recipeId     String
    recipe       Recipe   @relation(fields: [recipeId], references: [id])
    quantity     Int
    unitCost     Decimal  @db.Decimal(10, 4)
    totalCost    Decimal  @db.Decimal(10, 2)
    sellingPrice Decimal  @db.Decimal(10, 2)

    createdAt DateTime @default(now())

    @@index([menuItemId])
    @@index([createdAt])
}

// -----------------------------------------------------------------------------
// 9. Linen Management
// -----------------------------------------------------------------------------

model LinenItem {
    id              String         @id @default(uuid())
    stockItemId     String
    stockItem       StockItem      @relation(fields: [stockItemId], references: [id])
    serialNumber    String?
    type            LinenType
    size            String?
    condition       LinenCondition @default(NEW)
    status          LinenStatus    @default(IN_STOCK)
    warehouseId     String
    warehouse       Warehouse      @relation(fields: [warehouseId], references: [id])
    assignedRoomId  String?
    purchaseDate    DateTime?
    lastLaundryDate DateTime?
    cycleCount      Int            @default(0)
    damageNotes     String?        @db.Text
    retiredAt       DateTime?
    retiredReason   String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([warehouseId])
    @@index([status])
    @@index([type])
}

enum LinenType {
    BED_SHEET
    PILLOW_CASE
    DUVET_COVER
    TOWEL
    BATH_MAT
    BLANKET
}

enum LinenStatus {
    IN_STOCK
    IN_USE
    IN_LAUNDRY
    DAMAGED
    RETIRED
}

enum LinenCondition {
    NEW
    GOOD
    FAIR
    POOR
}

// -----------------------------------------------------------------------------
// 10. Cycle Count Management
// -----------------------------------------------------------------------------

enum CycleCountType {
    FULL
    ABC_CLASS_A
    ABC_CLASS_B
    ABC_CLASS_C
    RANDOM
    SPOT
}

enum CycleCountStatus {
    DRAFT
    SCHEDULED
    IN_PROGRESS
    PENDING_REVIEW
    COMPLETED
    CANCELLED
}

model CycleCount {
    id          String           @id @default(uuid())
    countNumber String           @unique // CC-2026-0001
    warehouseId String
    warehouse   Warehouse        @relation(fields: [warehouseId], references: [id])
    type        CycleCountType
    status      CycleCountStatus @default(DRAFT)
    blindCount  Boolean          @default(false) // Hide system qty from counters

    scheduledAt DateTime?
    startedAt   DateTime?
    completedAt DateTime?

    createdById  String
    approvedById String?
    notes        String? @db.Text

    // Calculated summary (updated on completion)
    totalItems        Int?
    itemsCounted      Int?
    itemsWithVariance Int?
    totalVarianceCost Decimal? @db.Decimal(12, 2)
    accuracyPercent   Decimal? @db.Decimal(5, 2)

    items CycleCountItem[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([warehouseId])
    @@index([status])
    @@index([scheduledAt])
}

// Individual item counts
model CycleCountItem {
    id           String      @id @default(uuid())
    cycleCountId String
    cycleCount   CycleCount  @relation(fields: [cycleCountId], references: [id], onDelete: Cascade)
    stockItemId  String
    stockItem    StockItem   @relation(fields: [stockItemId], references: [id])
    batchId      String?
    batch        StockBatch? @relation(fields: [batchId], references: [id])

    // Quantities
    systemQuantity  Decimal  @db.Decimal(10, 3) // Snapshot at count start
    countedQuantity Decimal? @db.Decimal(10, 3) // Physical count

    // Calculated variance
    variance        Decimal? @db.Decimal(10, 3)
    variancePercent Decimal? @db.Decimal(7, 2)
    varianceCost    Decimal? @db.Decimal(12, 2)
    unitCost        Decimal? @db.Decimal(10, 4) // Avg cost at count time

    // Audit
    countedById String?
    countedAt   DateTime?
    notes       String?

    // Adjustment tracking
    adjustmentMade Boolean @default(false)
    adjustmentId   String? // StockMovement ID

    @@unique([cycleCountId, stockItemId, batchId])
    @@index([cycleCountId])
    @@index([stockItemId])
}

// -----------------------------------------------------------------------------
// 11. Consignment Management
// -----------------------------------------------------------------------------

model ConsignmentReceipt {
    id           String   @id @default(uuid())
    supplierId   String
    supplier     Supplier @relation(fields: [supplierId], references: [id])
    warehouseId  String
    receivedById String
    notes        String?  @db.Text

    items ConsignmentReceiptItem[]

    receivedAt DateTime @default(now())

    @@index([supplierId])
}

model ConsignmentReceiptItem {
    id           String             @id @default(uuid())
    receiptId    String
    receipt      ConsignmentReceipt @relation(fields: [receiptId], references: [id], onDelete: Cascade)
    stockItemId  String
    stockItem    StockItem          @relation(fields: [stockItemId], references: [id])
    quantity     Decimal            @db.Decimal(10, 3)
    sellingPrice Decimal            @db.Decimal(10, 2)
    supplierCost Decimal            @db.Decimal(10, 2)

    @@index([receiptId])
}

model ConsignmentSale {
    id           String                 @id @default(uuid())
    stockItemId  String
    quantity     Decimal                @db.Decimal(10, 3)
    sellingPrice Decimal                @db.Decimal(10, 2)
    supplierCost Decimal                @db.Decimal(10, 2)
    settlementId String?
    settlement   ConsignmentSettlement? @relation(fields: [settlementId], references: [id])

    soldAt    DateTime  @default(now())
    settledAt DateTime?

    @@index([stockItemId])
    @@index([settlementId])
}

model ConsignmentSettlement {
    id               String   @id @default(uuid())
    supplierId       String
    supplier         Supplier @relation(fields: [supplierId], references: [id])
    periodStart      DateTime
    periodEnd        DateTime
    totalSales       Decimal  @db.Decimal(10, 2)
    totalSupplierDue Decimal  @db.Decimal(10, 2)

    sales ConsignmentSale[]

    settledAt DateTime?
    createdAt DateTime  @default(now())

    @@index([supplierId])
}

// -----------------------------------------------------------------------------
// 12. User-Warehouse Access Control
// -----------------------------------------------------------------------------

enum AccessLevel {
    VIEW
    MANAGE
    ADMIN
}

model UserWarehouseAccess {
    id          String      @id @default(uuid())
    userId      String
    warehouseId String
    accessLevel AccessLevel @default(VIEW)
    user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
    warehouse   Warehouse   @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
    createdAt   DateTime    @default(now())

    @@unique([userId, warehouseId])
    @@index([userId])
    @@index([warehouseId])
}

// -----------------------------------------------------------------------------
// 13. Point of Sale (POS) System
// -----------------------------------------------------------------------------

enum OutletType {
    RESTAURANT
    BAR
    ROOM_SERVICE
    POOL_BAR
    CAFE
    MINIBAR
}

enum POSTableStatus {
    AVAILABLE
    OCCUPIED
    RESERVED
    DIRTY
    OUT_OF_SERVICE
}

enum POSOrderStatus {
    OPEN
    SENT_TO_KITCHEN
    IN_PROGRESS
    READY
    SERVED
    PAID
    CANCELLED
    VOID
}

enum OrderItemStatus {
    PENDING
    SENT
    PREPARING
    READY
    SERVED
    CANCELLED
}

enum PaymentMethod {
    CASH
    CREDIT_CARD
    DEBIT_CARD
    ROOM_CHARGE
    VOUCHER
    COMPLIMENTARY
}

// POS Sales Outlet
model SalesOutlet {
    id          String     @id @default(uuid())
    propertyId  String
    name        String
    type        OutletType
    warehouseId String
    isActive    Boolean    @default(true)
    property    Property   @relation(fields: [propertyId], references: [id])
    warehouse   Warehouse  @relation(fields: [warehouseId], references: [id])
    tables      POSTable[]
    orders      POSOrder[]
    shifts      Shift[]
    createdAt   DateTime   @default(now())
    updatedAt   DateTime   @updatedAt

    @@index([propertyId])
}

// Table Management
model POSTable {
    id        String         @id @default(uuid())
    outletId  String
    number    String
    capacity  Int
    status    POSTableStatus @default(AVAILABLE)
    positionX Int?
    positionY Int?
    outlet    SalesOutlet    @relation(fields: [outletId], references: [id])
    orders    POSOrder[]
    createdAt DateTime       @default(now())
    updatedAt DateTime       @updatedAt

    @@unique([outletId, number])
    @@index([outletId])
    @@index([status])
}

// POS Order
model POSOrder {
    id             String          @id @default(uuid())
    orderNumber    String          @unique
    outletId       String
    tableId        String?
    bookingId      String?
    guestId        String?
    serverId       String
    shiftId        String?
    status         POSOrderStatus  @default(OPEN)
    subtotal       Decimal         @db.Decimal(12, 2)
    taxAmount      Decimal         @db.Decimal(12, 2)
    serviceCharge  Decimal         @default(0) @db.Decimal(12, 2)
    discountAmount Decimal         @default(0) @db.Decimal(12, 2)
    tipAmount      Decimal         @default(0) @db.Decimal(12, 2)
    total          Decimal         @db.Decimal(12, 2)
    notes          String?
    outlet         SalesOutlet     @relation(fields: [outletId], references: [id])
    table          POSTable?       @relation(fields: [tableId], references: [id])
    booking        Booking?        @relation(fields: [bookingId], references: [id])
    server         User            @relation("ServerOrders", fields: [serverId], references: [id])
    shift          Shift?          @relation(fields: [shiftId], references: [id])
    items          POSOrderItem[]
    payments       OrderPayment[]
    createdAt      DateTime        @default(now())
    updatedAt      DateTime        @updatedAt
    orderDiscounts OrderDiscount[]
    orderVoids     OrderVoid[]

    @@index([outletId])
    @@index([status])
    @@index([createdAt])
}

// Order Line Items
model POSOrderItem {
    id              String          @id @default(uuid())
    orderId         String
    menuItemId      String
    quantity        Int
    unitPrice       Decimal         @db.Decimal(12, 2)
    modifiers       String?
    notes           String?
    status          OrderItemStatus @default(PENDING)
    sentToKitchenAt DateTime?
    preparedAt      DateTime?
    servedAt        DateTime?
    order           POSOrder        @relation(fields: [orderId], references: [id], onDelete: Cascade)
    menuItem        MenuItem        @relation(fields: [menuItemId], references: [id])
    createdAt       DateTime        @default(now())

    @@index([orderId])
    @@index([status])
}

// Order Payments
model OrderPayment {
    id            String        @id @default(uuid())
    orderId       String
    amount        Decimal       @db.Decimal(12, 2)
    method        PaymentMethod
    reference     String?
    processedById String
    order         POSOrder      @relation(fields: [orderId], references: [id], onDelete: Cascade)
    processedBy   User          @relation("PaymentProcessor", fields: [processedById], references: [id])
    createdAt     DateTime      @default(now())

    @@index([orderId])
}

// -----------------------------------------------------------------------------
// 13.5 Discount Management
// -----------------------------------------------------------------------------

// Dynamic Discount Types
model DiscountType {
    id               String   @id @default(uuid())
    propertyId       String
    code             String // PWD, SENIOR, MANAGER, PROMO
    name             String // "PWD Discount"
    description      String?
    percentage       Decimal  @db.Decimal(5, 2) // 20.00 = 20%
    isActive         Boolean  @default(true)
    requiresId       Boolean  @default(false) // Require ID scan/number
    requiresApproval Boolean  @default(false) // Manager approval needed
    maxAmount        Decimal? @db.Decimal(12, 2) // Cap on discount amount

    property       Property        @relation(fields: [propertyId], references: [id])
    orderDiscounts OrderDiscount[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([propertyId, code])
    @@index([propertyId])
    @@index([isActive])
}

// Applied discounts on orders
model OrderDiscount {
    id             String  @id @default(uuid())
    orderId        String
    discountTypeId String
    amount         Decimal @db.Decimal(12, 2) // Calculated discount amount
    percentage     Decimal @db.Decimal(5, 2) // Snapshot of rate at time of application
    idNumber       String? // PWD/Senior ID if required
    approvedById   String? // Manager who approved
    notes          String?

    order        POSOrder     @relation(fields: [orderId], references: [id], onDelete: Cascade)
    discountType DiscountType @relation(fields: [discountTypeId], references: [id])
    approvedBy   User?        @relation("DiscountApprover", fields: [approvedById], references: [id])

    createdAt DateTime @default(now())

    @@index([orderId])
    @@index([discountTypeId])
}

// Void tracking with audit
model OrderVoid {
    id             String  @id @default(uuid())
    orderId        String
    itemId         String? // null = whole order voided
    reason         String
    voidedById     String // Who requested the void
    approvedById   String // Manager who approved
    originalAmount Decimal @db.Decimal(12, 2) // Amount being voided

    order      POSOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
    voidedBy   User     @relation("VoidCreator", fields: [voidedById], references: [id])
    approvedBy User     @relation("VoidApprover", fields: [approvedById], references: [id])

    createdAt DateTime @default(now())

    @@index([orderId])
    @@index([voidedById])
    @@index([approvedById])
}

// -----------------------------------------------------------------------------
// 14. Shift Management
// -----------------------------------------------------------------------------

enum ShiftStatus {
    OPEN
    CLOSED
}

enum ShiftType {
    DAY
    NIGHT
}

enum ReadingType {
    X_READING
    Z_READING
}

// Cashier Shift
model Shift {
    id           String      @id @default(uuid())
    outletId     String
    cashierId    String
    type         ShiftType   @default(DAY)
    startingCash Decimal     @db.Decimal(12, 2)
    endingCash   Decimal?    @db.Decimal(12, 2)
    expectedCash Decimal?    @db.Decimal(12, 2)
    variance     Decimal?    @db.Decimal(12, 2)
    status       ShiftStatus @default(OPEN)
    openedAt     DateTime    @default(now())
    closedAt     DateTime?
    notes        String?

    // X/Z Reading tracking
    xReadingCount  Int       @default(0)
    lastXReadingAt DateTime?
    zReadingAt     DateTime?

    // Handover
    handoverToId  String?
    handoverTo    User?   @relation("ShiftHandover", fields: [handoverToId], references: [id])
    handoverNotes String?

    outlet   SalesOutlet    @relation(fields: [outletId], references: [id])
    cashier  User           @relation("CashierShifts", fields: [cashierId], references: [id])
    orders   POSOrder[]
    readings ShiftReading[]

    @@index([outletId])
    @@index([cashierId])
    @@index([status])
    @@index([type])
}

// Shift Reading (X and Z readings)
model ShiftReading {
    id            String      @id @default(uuid())
    shiftId       String
    type          ReadingType
    readingNumber Int // Sequential number for this shift

    // Snapshot at reading time
    orderCount      Int
    totalSales      Decimal @db.Decimal(12, 2)
    cashSales       Decimal @db.Decimal(12, 2)
    cardSales       Decimal @db.Decimal(12, 2)
    roomChargeSales Decimal @db.Decimal(12, 2)
    otherSales      Decimal @db.Decimal(12, 2)
    voidCount       Int     @default(0)
    voidAmount      Decimal @default(0) @db.Decimal(12, 2)
    discountCount   Int     @default(0)
    discountTotal   Decimal @default(0) @db.Decimal(12, 2)
    refundAmount    Decimal @default(0) @db.Decimal(12, 2)

    generatedById String
    generatedBy   User     @relation("ReadingGenerator", fields: [generatedById], references: [id])
    shift         Shift    @relation(fields: [shiftId], references: [id])
    createdAt     DateTime @default(now())

    @@index([shiftId])
    @@index([type])
}

// -----------------------------------------------------------------------------
// 15. Purchase Order System
// -----------------------------------------------------------------------------

enum POStatus {
    DRAFT
    PENDING_APPROVAL
    APPROVED
    SENT
    PARTIALLY_RECEIVED
    RECEIVED
    CLOSED
    CANCELLED
}

// Purchase Order
model PurchaseOrder {
    id           String              @id @default(uuid())
    poNumber     String              @unique
    propertyId   String
    supplierId   String
    warehouseId  String
    status       POStatus            @default(DRAFT)
    expectedDate DateTime?
    subtotal     Decimal             @db.Decimal(12, 2)
    taxAmount    Decimal             @default(0) @db.Decimal(12, 2)
    total        Decimal             @db.Decimal(12, 2)
    notes        String?
    createdById  String
    approvedById String?
    approvedAt   DateTime?
    sentAt       DateTime?
    property     Property            @relation(fields: [propertyId], references: [id])
    supplier     Supplier            @relation(fields: [supplierId], references: [id])
    warehouse    Warehouse           @relation(fields: [warehouseId], references: [id])
    createdBy    User                @relation("POCreatedBy", fields: [createdById], references: [id])
    approvedBy   User?               @relation("POApprovedBy", fields: [approvedById], references: [id])
    items        PurchaseOrderItem[]
    receipts     POReceipt[]
    createdAt    DateTime            @default(now())
    updatedAt    DateTime            @updatedAt

    @@index([propertyId])
    @@index([status])
}

model PurchaseOrderItem {
    id              String        @id @default(uuid())
    purchaseOrderId String
    stockItemId     String
    quantity        Decimal       @db.Decimal(12, 4)
    unitCost        Decimal       @db.Decimal(12, 4)
    receivedQty     Decimal       @default(0) @db.Decimal(12, 4)
    purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
    stockItem       StockItem     @relation(fields: [stockItemId], references: [id])

    @@index([purchaseOrderId])
}

// PO Receipt
model POReceipt {
    id              String          @id @default(uuid())
    purchaseOrderId String
    receivedById    String
    notes           String?
    purchaseOrder   PurchaseOrder   @relation(fields: [purchaseOrderId], references: [id])
    receivedBy      User            @relation("POReceiver", fields: [receivedById], references: [id])
    items           POReceiptItem[]
    createdAt       DateTime        @default(now())

    @@index([purchaseOrderId])
}

model POReceiptItem {
    id             String    @id @default(uuid())
    poReceiptId    String
    stockItemId    String
    quantity       Decimal   @db.Decimal(12, 4)
    batchNumber    String?
    expirationDate DateTime?
    poReceipt      POReceipt @relation(fields: [poReceiptId], references: [id], onDelete: Cascade)
    stockItem      StockItem @relation(fields: [stockItemId], references: [id])

    @@index([poReceiptId])
}

// -----------------------------------------------------------------------------
// 16. Audit Trail System
// -----------------------------------------------------------------------------

// Audit Log
model AuditLog {
    id         String   @id @default(uuid())
    userId     String?
    action     String
    entityType String
    entityId   String
    oldValues  Json?
    newValues  Json?
    ipAddress  String?
    userAgent  String?
    user       User?    @relation(fields: [userId], references: [id])
    createdAt  DateTime @default(now())

    @@index([entityType, entityId])
    @@index([userId])
    @@index([createdAt])
}

// -----------------------------------------------------------------------------
// 17. Notification System
// -----------------------------------------------------------------------------

enum NotificationType {
    LOW_STOCK
    PO_APPROVAL
    REQUISITION_STATUS
    CYCLE_COUNT_REMINDER
    EXPIRING_BATCH
    ORDER_READY
    SYSTEM
}

// Notification
model Notification {
    id        String           @id @default(uuid())
    userId    String
    type      NotificationType
    title     String
    message   String
    data      Json?
    isRead    Boolean          @default(false)
    readAt    DateTime?
    user      User             @relation(fields: [userId], references: [id])
    createdAt DateTime         @default(now())

    @@index([userId, isRead])
    @@index([createdAt])
}

// -----------------------------------------------------------------------------
// 7. Events & Functions (Room Blocking)
// -----------------------------------------------------------------------------

model Event {
    id          String      @id @default(uuid())
    title       String
    description String?     @db.Text
    startDate   DateTime
    endDate     DateTime
    status      EventStatus @default(TENTATIVE)

    // Event Details
    guestCount  Int?
    roomCount   Int? // Target number of rooms
    menuDetails Json? // Structured menu selection
    notes       String? @db.Text

    // Relations
    propertyId String
    property   Property @relation(fields: [propertyId], references: [id])

    // An event can be linked to bookings if specific rooms are blocked/reserved
    bookings Booking[]

    // Audit
    createdById String?
    updatedById String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([propertyId])
    @@index([startDate, endDate])
}

enum EventStatus {
    TENTATIVE
    CONFIRMED
    CANCELLED
    COMPLETED
}
